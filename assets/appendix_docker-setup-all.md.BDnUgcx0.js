import{_ as i,c as a,o as n,ae as l}from"./chunks/framework.Ai_99reE.js";const c=JSON.parse('{"title":"Vue3 & FastAPI Docker化 完全ガイド","description":"","frontmatter":{},"headers":[],"relativePath":"appendix/docker-setup-all.md","filePath":"appendix/docker-setup-all.md"}'),e={name:"appendix/docker-setup-all.md"};function p(t,s,h,k,d,r){return n(),a("div",null,[...s[0]||(s[0]=[l(`<h1 id="vue3-fastapi-docker化-完全ガイド" tabindex="-1">Vue3 &amp; FastAPI Docker化 完全ガイド <a class="header-anchor" href="#vue3-fastapi-docker化-完全ガイド" aria-label="Permalink to &quot;Vue3 &amp; FastAPI Docker化 完全ガイド&quot;">​</a></h1><p>このドキュメントは、Vue3とFastAPIで構成されたWebアプリケーションを、Dockerを用いてコンテナ化するための完全な手順を記したものです。ホットリロード対応の<strong>開発環境</strong>と、Nginxリバースプロキシを採用した<strong>本番環境</strong>の2つの構成を構築します。</p><h2 id="最終的なアーキテクチャ" tabindex="-1">最終的なアーキテクチャ <a class="header-anchor" href="#最終的なアーキテクチャ" aria-label="Permalink to &quot;最終的なアーキテクチャ&quot;">​</a></h2><ul><li><strong>開発環境</strong>: フロントエンドとバックエンドがそれぞれのコンテナで起動し、ホットリロードにより快適な開発を実現します。</li><li><strong>本番環境</strong>: フロントエンドのNginxコンテナを唯一の窓口とし、APIへのリクエストは内部的にバックエンドコンテナへ転送（リバースプロキシ）することで、シンプルでセキュアな構成を実現します。</li></ul><h2 id="_1-プロジェクト構成の整理" tabindex="-1">1. プロジェクト構成の整理 <a class="header-anchor" href="#_1-プロジェクト構成の整理" aria-label="Permalink to &quot;1. プロジェクト構成の整理&quot;">​</a></h2><h3 id="_1-1-目指す構成" tabindex="-1">1.1. 目指す構成 <a class="header-anchor" href="#_1-1-目指す構成" aria-label="Permalink to &quot;1.1. 目指す構成&quot;">​</a></h3><p>まず、プロジェクト全体を以下のディレクトリ構成に整理します。これにより、関心事が明確に分離され、Dockerのビルド効率も向上します。</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>my-recipes/</span></span>
<span class="line"><span>├── backend/</span></span>
<span class="line"><span>│   ├── api/</span></span>
<span class="line"><span>│   │   └── main.py</span></span>
<span class="line"><span>│   ├── Dockerfile</span></span>
<span class="line"><span>│   ├── requirements.txt</span></span>
<span class="line"><span>│   └── .env</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── frontend/</span></span>
<span class="line"><span>│   ├── src/</span></span>
<span class="line"><span>│   ├── public/</span></span>
<span class="line"><span>│   ├── Dockerfile</span></span>
<span class="line"><span>│   ├── nginx.conf</span></span>
<span class="line"><span>│   ├── package.json</span></span>
<span class="line"><span>│   └── vite.config.ts</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── docker-compose.yml</span></span>
<span class="line"><span>└── docker-compose.dev.yml</span></span></code></pre></div><h3 id="_1-2-既存構成からの移行手順" tabindex="-1">1.2. 既存構成からの移行手順 <a class="header-anchor" href="#_1-2-既存構成からの移行手順" aria-label="Permalink to &quot;1.2. 既存構成からの移行手順&quot;">​</a></h3><p>当初の混在構成から、上記の構成に移行するための考え方と具体的なコマンドです。</p><h4 id="ファイル・ディレクトリの選定基準" tabindex="-1">ファイル・ディレクトリの選定基準 <a class="header-anchor" href="#ファイル・ディレクトリの選定基準" aria-label="Permalink to &quot;ファイル・ディレクトリの選定基準&quot;">​</a></h4><ul><li><strong><code>frontend/</code> に移動するもの</strong>: ブラウザで動作するUIに関連するすべて。 <ul><li>Vueのソースコード (<code>src/</code>)</li><li>静的ファイル (<code>public/</code>, <code>index.html</code>)</li><li>Node.jsの依存関係とスクリプト (<code>package.json</code>, <code>package-lock.json</code>)</li><li>ViteやTypeScriptのビルド設定 (<code>vite.config.ts</code>, <code>tsconfig.*.json</code>)</li></ul></li><li><strong><code>backend/</code> に移動するもの</strong>: サーバーサイドで動作するAPIに関連するすべて。 <ul><li>FastAPIのソースコード (<code>api/</code>)</li><li>Pythonの依存関係 (<code>requirements.txt</code>)</li></ul></li><li><strong>ルート直下に残すもの</strong>: プロジェクト全体に関わるもの。 <ul><li>バージョン管理設定 (<code>.gitignore</code>など)</li><li>ドキュメント (<code>README.md</code>など)</li><li>Dockerの全体設定 (<code>docker-compose.yml</code>など)</li></ul></li></ul><h4 id="具体的なコマンド" tabindex="-1">具体的なコマンド <a class="header-anchor" href="#具体的なコマンド" aria-label="Permalink to &quot;具体的なコマンド&quot;">​</a></h4><ol><li><p><strong>ディレクトリの作成:</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frontend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backend</span></span></code></pre></div></li><li><p><strong>ファイルの移動:</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># フロントエンド関連のファイルを &quot;frontend&quot; へ移動</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> public</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> index.html</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> package.json</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> package-lock.json</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vite.config.ts</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tsconfig</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.json</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frontend/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># バックエンド関連のファイルを &quot;backend&quot; へ移動</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> api</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> requirements.txt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backend/</span></span></code></pre></div></li></ol><h2 id="_2-開発環境の構築" tabindex="-1">2. 開発環境の構築 <a class="header-anchor" href="#_2-開発環境の構築" aria-label="Permalink to &quot;2\\. 開発環境の構築&quot;">​</a></h2><p>ホットリロードに対応した快適な開発環境を構築します。</p><h3 id="_2-1-設定ファイル" tabindex="-1">2.1. 設定ファイル <a class="header-anchor" href="#_2-1-設定ファイル" aria-label="Permalink to &quot;2.1. 設定ファイル&quot;">​</a></h3><h4 id="backend-dockerfile" tabindex="-1"><code>backend/Dockerfile</code> <a class="header-anchor" href="#backend-dockerfile" aria-label="Permalink to &quot;\`backend/Dockerfile\`&quot;">​</a></h4><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> python:3.11-slim</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /app</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> requirements.txt .</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pip install --no-cache-dir -r requirements.txt</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ./api ./api</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 8686</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;uvicorn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;api.main:app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;--host&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.0.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;--port&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;8686&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><h4 id="backend-requirements-txt" tabindex="-1"><code>backend/requirements.txt</code> <a class="header-anchor" href="#backend-requirements-txt" aria-label="Permalink to &quot;\`backend/requirements.txt\`&quot;">​</a></h4><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>fastapi</span></span>
<span class="line"><span>httpx</span></span>
<span class="line"><span>python-dotenv</span></span>
<span class="line"><span>uvicorn[standard]</span></span></code></pre></div><h4 id="backend-env" tabindex="-1"><code>backend/.env</code> <a class="header-anchor" href="#backend-env" aria-label="Permalink to &quot;\`backend/.env\`&quot;">​</a></h4><div class="danger custom-block"><p class="custom-block-title">注意</p><p>このファイルは<code>.gitignore</code>に追加し、Gitで管理しないでください。</p></div><div class="language-env vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">env</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>RAKUTEN_APP_ID=ここにあなたの楽天アプリIDを入力</span></span></code></pre></div><h4 id="frontend-dockerfile" tabindex="-1"><code>frontend/Dockerfile</code> <a class="header-anchor" href="#frontend-dockerfile" aria-label="Permalink to &quot;\`frontend/Dockerfile\`&quot;">​</a></h4><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># --- ビルドステージ (開発/本番で共通利用) ---</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> node:20-alpine </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> build-stage</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /app</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> package*.json ./</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> npm install</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> . .</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> npm run build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># --- プロダクションステージ ---</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nginx:stable-alpine </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> production-stage</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=build-stage /app/dist /usr/share/nginx/html</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nginx.conf /etc/nginx/conf.d/default.conf</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 80</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;nginx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-g&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;daemon off;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><h4 id="frontend-vite-config-ts" tabindex="-1"><code>frontend/vite.config.ts</code> <a class="header-anchor" href="#frontend-vite-config-ts" aria-label="Permalink to &quot;\`frontend/vite.config.ts\`&quot;">​</a></h4><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vite&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@vitejs/plugin-vue&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  plugins: [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  server: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    host: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;0.0.0.0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    port: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5173</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    proxy: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;/api&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        target: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://backend:8686&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        changeOrigin: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">なぜこの設定が必要？</p><ul><li><strong><code>host: &#39;0.0.0.0&#39;</code></strong>: コンテナ外部（ホストPC）のブラウザからアクセスできるようにします。</li><li><strong><code>target: &#39;http://backend:8686&#39;</code></strong>: Dockerコンテナ同士はサービス名で通信します。<code>frontend</code>コンテナから<code>backend</code>コンテナへ正しくリクエストを転送するために必要です。 :::</li></ul><h4 id="docker-compose-dev-yml" tabindex="-1"><code>docker-compose.dev.yml</code> <a class="header-anchor" href="#docker-compose-dev-yml" aria-label="Permalink to &quot;\`docker-compose.dev.yml\`&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;3.8&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  backend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./backend</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;8686:8686&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./backend:/app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">uvicorn api.main:app --reload --host 0.0.0.0 --port 8686</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    env_file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./backend/.env</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  frontend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./frontend</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">build-stage</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;5173:5173&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./frontend:/app</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/app/node_modules</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">npm run dev</span></span></code></pre></div><h3 id="_2-2-起動とアクセス" tabindex="-1">2.2. 起動とアクセス <a class="header-anchor" href="#_2-2-起動とアクセス" aria-label="Permalink to &quot;2.2. 起動とアクセス&quot;">​</a></h3><ul><li><strong>起動コマンド</strong>: <code>docker-compose -f docker-compose.dev.yml up --build</code></li><li><strong>フロントエンドURL</strong>: <code>http://localhost:5173</code></li><li><strong>バックエンドURL</strong>: <code>http://localhost:8686/docs</code></li></ul><h2 id="_3-本番環境の構築" tabindex="-1">3. 本番環境の構築 <a class="header-anchor" href="#_3-本番環境の構築" aria-label="Permalink to &quot;3\\. 本番環境の構築&quot;">​</a></h2><p>Nginxリバースプロキシを導入した、最適化された本番環境を構築します。</p><h3 id="_3-1-設定ファイル" tabindex="-1">3.1. 設定ファイル <a class="header-anchor" href="#_3-1-設定ファイル" aria-label="Permalink to &quot;3.1. 設定ファイル&quot;">​</a></h3><p>開発環境で作成したファイルに加え、以下の2ファイルを修正します。</p><h4 id="frontend-nginx-conf" tabindex="-1"><code>frontend/nginx.conf</code> <a class="header-anchor" href="#frontend-nginx-conf" aria-label="Permalink to &quot;\`frontend/nginx.conf\`&quot;">​</a></h4><p>リバースプロキシ設定を追記します。</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localhost;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/usr/share/nginx/html;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index.html;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try_files </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$uri $uri/ /index.html;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # APIリクエストをバックエンドコンテナへ転送する設定</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /api/ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://backend:8686;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Host $host;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Forwarded-Proto $scheme;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="docker-compose-yml" tabindex="-1"><code>docker-compose.yml</code> <a class="header-anchor" href="#docker-compose-yml" aria-label="Permalink to &quot;\`docker-compose.yml\`&quot;">​</a></h4><p><code>backend</code>サービスのポート公開を削除し、窓口を<code>frontend</code>サービスに一本化します。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;3.8&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  backend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./backend</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">always</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # portsセクションを削除</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">uvicorn api.main:app --host 0.0.0.0 --port 8686</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    env_file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./backend/.env</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  frontend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./frontend</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">always</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;8080:80&quot;</span></span></code></pre></div><h3 id="_3-2-起動とアクセス" tabindex="-1">3.2. 起動とアクセス <a class="header-anchor" href="#_3-2-起動とアクセス" aria-label="Permalink to &quot;3.2. 起動とアクセス&quot;">​</a></h3><ul><li><strong>起動コマンド</strong>: <code>docker-compose up --build -d</code></li><li><strong>アクセスURL</strong>: <code>http://localhost:8080</code> (このURLですべて完結)</li></ul><h2 id="_4-今後の展望" tabindex="-1">4. 今後の展望 <a class="header-anchor" href="#_4-今後の展望" aria-label="Permalink to &quot;4\\. 今後の展望&quot;">​</a></h2><ul><li><strong>CI/CDの導入</strong>: GitHub Actionsなどを使い、デプロイを自動化する。</li><li><strong>データベースの永続化</strong>: <code>volumes</code>を使い、データベースコンテナのデータを永続化する。</li></ul><hr></div>`,29)])])}const E=i(e,[["render",p]]);export{c as __pageData,E as default};
