import{_ as i,c as a,o as n,ae as e}from"./chunks/framework.CDjunVez.js";const r=JSON.parse('{"title":"ローカル開発環境のDocker化手順","description":"","frontmatter":{},"headers":[],"relativePath":"appendix/docker-setup-local.md","filePath":"appendix/docker-setup-local.md"}'),l={name:"appendix/docker-setup-local.md"};function p(t,s,h,k,d,o){return n(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="ローカル開発環境のdocker化手順" tabindex="-1">ローカル開発環境のDocker化手順 <a class="header-anchor" href="#ローカル開発環境のdocker化手順" aria-label="Permalink to &quot;ローカル開発環境のDocker化手順&quot;">​</a></h1><p>このドキュメントは、Vite(Vue3)製のフロントエンドとFastAPI製のバックエンドから成る<code>my-recipes</code>プロジェクトを、Docker Composeを用いてローカル開発環境で起動するための手順をまとめたものです。</p><h2 id="なぜdocker化するのか" tabindex="-1">なぜDocker化するのか？ <a class="header-anchor" href="#なぜdocker化するのか" aria-label="Permalink to &quot;なぜDocker化するのか？&quot;">​</a></h2><ul><li><strong>環境の統一:</strong> 誰が実行しても同じ環境が再現されるため、「自分のPCでは動くのに他の人のでは動かない」といった問題を防止できます。</li><li><strong>セットアップの簡略化:</strong> <code>node</code>や<code>python</code>のバージョンを気にすることなく、<code>docker-compose</code>コマンド一発で開発環境を起動できます。</li><li><strong>本番環境への移行:</strong> 開発環境と本番環境の構成を近づけることで、デプロイ時のトラブルを減らせます。</li></ul><h2 id="前提" tabindex="-1">前提 <a class="header-anchor" href="#前提" aria-label="Permalink to &quot;前提&quot;">​</a></h2><p>以下のツールがインストールされていることを前提とします。</p><ul><li>Docker</li><li>Docker Compose</li></ul><h2 id="_1-プロジェクト構成" tabindex="-1">1. プロジェクト構成 <a class="header-anchor" href="#_1-プロジェクト構成" aria-label="Permalink to &quot;1. プロジェクト構成&quot;">​</a></h2><p>まず、プロジェクト全体を以下のディレクトリ構成に整理します。これにより、フロントエンドとバックエンドの関心事が明確に分離され、Dockerのビルド効率も向上します。</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>my-recipes/</span></span>
<span class="line"><span>├── backend/</span></span>
<span class="line"><span>│   ├── api/</span></span>
<span class="line"><span>│   │   └── main.py</span></span>
<span class="line"><span>│   ├── Dockerfile</span></span>
<span class="line"><span>│   ├── requirements.txt</span></span>
<span class="line"><span>│   └── .env</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── frontend/</span></span>
<span class="line"><span>│   ├── src/</span></span>
<span class="line"><span>│   ├── public/</span></span>
<span class="line"><span>│   ├── Dockerfile</span></span>
<span class="line"><span>│   ├── nginx.conf</span></span>
<span class="line"><span>│   ├── package.json</span></span>
<span class="line"><span>│   └── vite.config.ts</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── docker-compose.yml</span></span>
<span class="line"><span>└── docker-compose.dev.yml</span></span></code></pre></div><h3 id="_1-1-既存構成からの移行手順" tabindex="-1">1.1. 既存構成からの移行手順 <a class="header-anchor" href="#_1-1-既存構成からの移行手順" aria-label="Permalink to &quot;1.1. 既存構成からの移行手順&quot;">​</a></h3><p>当初のプロジェクトは、フロントエンドとバックエンドのファイルがルートディレクトリに混在していました。それを上記の構成に整理するための考え方と手順です。</p><h4 id="ファイル・ディレクトリの選定基準" tabindex="-1">ファイル・ディレクトリの選定基準 <a class="header-anchor" href="#ファイル・ディレクトリの選定基準" aria-label="Permalink to &quot;ファイル・ディレクトリの選定基準&quot;">​</a></h4><ul><li><p><strong><code>frontend/</code> に移動するもの</strong>: ブラウザで動作するUI（ユーザインタフェース）に関連するすべて。</p><ul><li>Vueのソースコード (<code>src/</code>)</li><li>静的ファイル（画像など） (<code>public/</code>, <code>index.html</code>)</li><li>Node.jsの依存関係とスクリプト (<code>package.json</code>, <code>package-lock.json</code>)</li><li>ViteやTypeScriptのビルド設定 (<code>vite.config.ts</code>, <code>tsconfig.*.json</code>)</li><li>エディタの設定 (<code>.vscode/</code>)</li></ul></li><li><p><strong><code>backend/</code> に移動するもの</strong>: サーバーサイドで動作するAPIに関連するすべて。</p><ul><li>FastAPIのソースコード (<code>api/</code>)</li><li>Pythonの依存関係 (<code>requirements.txt</code>)</li></ul></li><li><p><strong>ルート直下に残すもの</strong>: プロジェクト全体に関わるもの。</p><ul><li>バージョン管理設定 (<code>.git/</code>, <code>.gitignore</code>)</li><li>ドキュメント (<code>README.md</code>, <code>docs/</code>)</li><li>Dockerの全体設定 (<code>docker-compose.yml</code>, <code>docker-compose.dev.yml</code>)</li></ul></li></ul><h4 id="具体的なコマンド" tabindex="-1">具体的なコマンド <a class="header-anchor" href="#具体的なコマンド" aria-label="Permalink to &quot;具体的なコマンド&quot;">​</a></h4><p>プロジェクトのルートディレクトリで以下のコマンドを順に実行します。</p><ol><li><p><strong>ディレクトリの作成:</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frontend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backend</span></span></code></pre></div></li><li><p><strong>ファイルの移動:</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># フロントエンド関連のファイルを &quot;frontend&quot; へ移動</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> public</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> index.html</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> package.json</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> package-lock.json</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vite.config.ts</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tsconfig.json</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tsconfig.node.json</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tsconfig.app.json</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .vscode</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frontend/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># バックエンド関連のファイルを &quot;backend&quot; へ移動</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> api</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> requirements.txt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backend/</span></span></code></pre></div></li></ol><h2 id="_2-各種設定ファイル" tabindex="-1">2. 各種設定ファイル <a class="header-anchor" href="#_2-各種設定ファイル" aria-label="Permalink to &quot;2\\. 各種設定ファイル&quot;">​</a></h2><p>開発環境の起動（<code>docker-compose.dev.yml</code>）に必要なファイルです。</p><h3 id="バックエンド-backend" tabindex="-1">バックエンド (<code>backend/</code>) <a class="header-anchor" href="#バックエンド-backend" aria-label="Permalink to &quot;バックエンド (\`backend/\`)&quot;">​</a></h3><h4 id="backend-dockerfile" tabindex="-1"><code>backend/Dockerfile</code> <a class="header-anchor" href="#backend-dockerfile" aria-label="Permalink to &quot;\`backend/Dockerfile\`&quot;">​</a></h4><p>Python環境を構築し、FastAPIアプリケーションを起動します。</p><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Pythonの公式イメージをベースにする</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> python:3.11-slim</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 作業ディレクトリを設定</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /app</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 依存関係ファイルをコピーしてインストール</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> requirements.txt .</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pip install --no-cache-dir --upgrade pip &amp;&amp; \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pip install --no-cache-dir -r requirements.txt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># アプリケーションコードをコピー</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ./api ./api</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ポート8686を公開</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 8686</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># コンテナ起動時に実行するコマンド (本番用)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;uvicorn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;api.main:app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;--host&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.0.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;--port&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;8686&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><h4 id="backend-requirements-txt" tabindex="-1"><code>backend/requirements.txt</code> <a class="header-anchor" href="#backend-requirements-txt" aria-label="Permalink to &quot;\`backend/requirements.txt\`&quot;">​</a></h4><p>FastAPIサーバーの実行に必要なPythonライブラリを定義します。</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>fastapi</span></span>
<span class="line"><span>httpx</span></span>
<span class="line"><span>python-dotenv</span></span>
<span class="line"><span>uvicorn[standard]</span></span></code></pre></div><h4 id="backend-env" tabindex="-1"><code>backend/.env</code> <a class="header-anchor" href="#backend-env" aria-label="Permalink to &quot;\`backend/.env\`&quot;">​</a></h4><p>APIキーなどの機密情報を環境変数として定義します。</p><div class="danger custom-block"><p class="custom-block-title">注意</p><p>この<code>.env</code>ファイルは、<code>.gitignore</code>に追加してGitリポジトリにコミットしないようにしてください。</p></div><div class="language-env vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">env</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>RAKUTEN_APP_ID=ここにあなたの楽天アプリIDを入力</span></span></code></pre></div><h3 id="フロントエンド-frontend" tabindex="-1">フロントエンド (<code>frontend/</code>) <a class="header-anchor" href="#フロントエンド-frontend" aria-label="Permalink to &quot;フロントエンド (\`frontend/\`)&quot;">​</a></h3><h4 id="frontend-dockerfile" tabindex="-1"><code>frontend/Dockerfile</code> <a class="header-anchor" href="#frontend-dockerfile" aria-label="Permalink to &quot;\`frontend/Dockerfile\`&quot;">​</a></h4><p><code>npm run dev</code> を実行するためのNode.js環境を定義します。（開発時は<code>build-stage</code>のみが使用されます）</p><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># --- ビルドステージ ---</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> node:20-alpine </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> build-stage</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /app</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> package*.json ./</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> npm install</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> . .</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># buildスクリプトを実行 (本番用)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> npm run build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># --- プロダクションステージ ---</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nginx:stable-alpine </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> production-stage</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=build-stage /app/dist /usr/share/nginx/html</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nginx.conf /etc/nginx/conf.d/default.conf</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 80</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;nginx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-g&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;daemon off;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><h4 id="frontend-vite-config-ts" tabindex="-1"><code>frontend/vite.config.ts</code> <a class="header-anchor" href="#frontend-vite-config-ts" aria-label="Permalink to &quot;\`frontend/vite.config.ts\`&quot;">​</a></h4><p>Vite開発サーバーの設定です。Dockerコンテナ内での利用にはいくつかの重要な変更点があります。</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vite&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@vitejs/plugin-vue&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  plugins: [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  server: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // コンテナ外（ホストPC）からのアクセスを許可</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    host: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;0.0.0.0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    port: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5173</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    proxy: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;/api&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // APIリクエストの転送先をDockerサービス名に変更</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        target: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://backend:8686&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        changeOrigin: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">なぜ設定変更が必要？</p><ul><li><strong><code>host: &#39;0.0.0.0&#39;</code></strong>: デフォルトの<code>localhost</code>のままだと、コンテナ内部からしかアクセスできません。<code>0.0.0.0</code>に設定することで、ホストPCのブラウザから<code>http://localhost:5173</code>でアクセスできるようになります。</li><li><strong><code>target: &#39;http://backend:8686&#39;</code></strong>: <code>docker-compose</code>で起動したコンテナ群は、独自のネットワークを形成します。コンテナ同士は<code>localhost</code>ではなく、<code>docker-compose.dev.yml</code>で定義した<strong>サービス名</strong>（今回は<code>backend</code>）で通信します。 :::</li></ul><h3 id="ルートディレクトリ" tabindex="-1">ルートディレクトリ <a class="header-anchor" href="#ルートディレクトリ" aria-label="Permalink to &quot;ルートディレクトリ&quot;">​</a></h3><h4 id="docker-compose-dev-yml" tabindex="-1"><code>docker-compose.dev.yml</code> <a class="header-anchor" href="#docker-compose-dev-yml" aria-label="Permalink to &quot;\`docker-compose.dev.yml\`&quot;">​</a></h4><p>開発環境における各サービス（コンテナ）の振る舞いを定義するオーケストレーションファイルです。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;3.8&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  backend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./backend</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;8686:8686&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./backend:/app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">uvicorn api.main:app --reload --host 0.0.0.0 --port 8686</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    env_file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./backend/.env</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  frontend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./frontend</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">build-stage</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;5173:5173&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./frontend:/app</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/app/node_modules</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">npm run dev</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title"><code>volumes</code> と <code>env_file</code></p><ul><li><strong><code>volumes</code></strong>: ホストPCのディレクトリをコンテナ内のディレクトリに同期させます。これにより、コードを修正した際にコンテナを再起動することなく、変更が即座に反映されます（ホットリロード）。</li><li><strong><code>env_file</code></strong>: 指定した<code>.env</code>ファイルの内容を、環境変数としてコンテナに渡します。 :::</li></ul><h2 id="_3-起動方法" tabindex="-1">3. 起動方法 <a class="header-anchor" href="#_3-起動方法" aria-label="Permalink to &quot;3\\. 起動方法&quot;">​</a></h2><p>プロジェクトのルートディレクトリで以下のコマンドを実行します。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-compose.dev.yml</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --build</span></span></code></pre></div><ul><li><code>--build</code>: 初回起動時や<code>Dockerfile</code>に変更があった場合にイメージを再構築します。</li></ul><h2 id="_4-アクセス方法" tabindex="-1">4. アクセス方法 <a class="header-anchor" href="#_4-アクセス方法" aria-label="Permalink to &quot;4\\. アクセス方法&quot;">​</a></h2><p>コンテナ起動後、以下のURLにブラウザでアクセスします。</p><ul><li><strong>フロントエンド画面:</strong> <code>http://localhost:5173</code></li><li><strong>バックエンドAPIドキュメント:</strong> <code>http://localhost:8686/docs</code></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span></code></pre></div></div></div>`,38)])])}const E=i(l,[["render",p]]);export{r as __pageData,E as default};
