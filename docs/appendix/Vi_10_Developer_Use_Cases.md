## １ 開発者のための vi（Vim）実践ユースケース10選

![vi1.開発者のためのvi（Vim）実戦ユースケース１０選](/images/gamehub/vi1.開発者のためのvi（Vim）実戦ユースケース１０選.jpg)

### 図の要旨

サーバサイドでの**編集・調査・修正**を「最速」にするための、開発者向けvi（Vim）ユースケース集の表紙。

### 詳細解説

* この資料の主戦場は、**GUIが使えない／使いづらい環境**（踏み台、コンテナ内、最小構成サーバ、権限制約など）です。
* vi/Vimは「入力ツール」ではなく、**テキスト操作（移動・抽出・置換・整形・比較）を統合した作業台**として強い。
* 以降のケースは、単発機能ではなく「**よくある開発者の痛点**」を起点に構成されています。

### Tips（導入の勝ち筋）

* まず全部覚えず、**Case1（安全置換）・Case2（矩形編集）・Case10（ジャンプ/検索）**の3つだけ先に身体に入れると、以降が加速します。
* viとVimの差：多くの現場では実体がVim（またはNeovim）になっていることが多いですが、**“vi互換モード”**になっている環境もあるため、困ったら `vim --version` を確認します。

---

## ２ なぜ、今あえて vi なのか？

![vi2.なぜ、いまあえてviなのか？](/images/gamehub/vi2.なぜ、いまあえてviなのか？.jpg)

### 図の要旨

開発者の典型的な痛点（GUI不可、緊急ログ調査、素早い設定修正）に対する「解」がviであることを示す。

### 詳細解説

* **GUIが使えないサーバ環境**：最小構成OS、セキュアゾーン、踏み台などではGUI前提手順が破綻します。
* **緊急時のログ調査**：巨大ログを「スクロール」ではなく、**検索・ジャンプ・抽出**でさばく必要がある。
* **素早い設定ファイル修正**：小さな差分を安全に入れたい（誤置換・誤編集が致命傷になり得る）。

### Tips（“コピペで働く”運用）

* 本資料の各Caseは、**コマンドを覚えるよりも「困ったらこの型」** として使うのが狙いです。
* 現場での最短ルートは、`:help` を読み込むより先に **“1回でも実案件で使う”** ことです（手が覚えます）。

---

## ３ Case 1：確認しながら安全にすべて置換する

![vi3.確認しながら安全にすべて置換する](/images/gamehub/vi3.確認しながら安全にすべて置換する.jpg)

### 図の要旨

`:%s/置換前/置換後/gc` により、**ファイル全体**を対象に、**複数一致**を置換しつつ、**確認（confirm）**で誤爆を防ぐ。

### 詳細解説

基本形：

```vim
:%s/old/new/gc
```

* `:%s`：ファイル全体（`%`）に対する置換
* `g`：同一行に複数マッチしても全て置換
* `c`：1件ずつ確認（壊しにくい）

確認プロンプトでよく使う選択肢：

* `y`：この1件を置換
* `n`：この1件は置換しない
* `a`：以降すべて置換（確認終了）
* `q`：中断（撤退できる）
* `l`：この1件だけ置換して終了

### Tips（誤爆をさらに減らす実務テク）

1. **単語境界で変数名置換の誤爆を防ぐ**

```vim
:%s/\<user\>/member/gc
```

* `userId` 等を巻き込まず、`user` 単体だけを狙いやすい。

2. 置換の“件数”だけ先に見る（プレビュー）

```vim
:%s/old/new/gn
```

* `n` は置換せず件数表示（Vimで有効なことが多い）。

3. 設定で安全性を底上げ（.vimrc）

* `set incsearch`（入力中に当たりが見える）
* `set hlsearch`（当たりがハイライトされる）

---
## ４ Case 2：縦一列をまとめて編集する（矩形選択）

![vi4.縦一列をまとめて編集する（矩形選択）](/images/gamehub/vi4.縦一列をまとめて編集する（矩形選択）.jpg)

### 図の要旨

`Ctrl+v（環境によってはCtrl+qの場合あり）` の**矩形ビジュアルモード（Visual Block）**で、複数行に対して「同じ列操作」を一括適用できる。

### 詳細解説

代表例：複数行の先頭に `#` を付けてコメントアウト

1. `Ctrl+v`：矩形ビジュアルモード開始
2. `j/k`：上下移動で範囲選択
3. `I`（大文字）：先頭に文字挿入（例：`#`）
4. `Esc`：各行に反映

```text
※ “vモード” ではありますが、v（文字選択）とは別物です。
- v   : 文字単位（1次元）
- V   : 行単位
- Ctrl+v : 矩形（2次元、列編集）
```

### Tips（現場で本当に使う列編集パターン）

1. 先頭に `//` や `#` をまとめて付ける（設定ファイル/コードの一時無効化）
2. インデントを列で揃える（YAML/TS/SQL整形の下準備）
3. 矩形で“列”を削除する

* 矩形選択 → `d`（選択範囲を削除）

4. **Ctrl+vが貼り付けに奪われる問題**

* 端末/VSCodeによっては `Ctrl+v` が paste になる場合があります。
* 回避策の定番：

  * `Ctrl+q` が矩形開始として機能することが多い
  * 貼り付けを `Ctrl+Shift+v` に寄せる（端末設定）

---

## ５ Case 3：面倒な繰り返し作業を自動化する（マクロ）

![vi5.面倒な繰り返し作業を自動化する](/images/gamehub/vi5.面倒な繰り返し作業を自動化する.jpg)

### 図の要旨

`qa ... q` で操作を記録し、`@a` で再生することで、反復編集を自動化できる。

### 詳細解説

基本形：

1. `qa`：レジスタaに記録開始
2. 操作を実行（編集→移動…）
3. `q`：記録停止
4. `@a`：再生
5. `100@a`：100回再生

### Tips（壊れにくいマクロ運用）

1. いきなり大量実行しない

* まず2〜3行で `@a` を試し、問題なければ `10@a` のように増やす。

2. 行移動は `j` より “次のターゲット検索” が安定

```vim
/target<Enter>
```

* 欠損行や例外行が混ざっても崩れにくい。

3. マクロ編集（上級だが強い）

* 記録した内容はレジスタに入るので、`"ap` 等で中身確認・微修正が可能（慣れてきたら）。

---

## ６ Case 4：ファイルの差分を見ながら修正する（vim -d）

![vi6.ファイルの差分を見ながら修正する](/images/gamehub/vi6.ファイルの差分を見ながら修正する.jpg)

### 図の要旨

`vim -d file_A.conf file_B.conf` で差分を可視化し、`do`/`dp` で片側の変更を取り込める。

### 詳細解説

起動：

```bash
vim -d file_A.conf file_B.conf
```

差分取り込み：

* `do`（diff obtain）：相手側の変更をこちらへ取り込む
* `dp`（diff put）：こちらの変更を相手へ送る

### Tips（差分移動と“比較作業の型”）

1. 差分ブロック間ジャンプ

* `]c`：次の差分へ
* `[c`：前の差分へ

2. Gitが使えない/使いづらい本番環境で特に効く

* “バックアップとの差分だけ戻す”
* “設定変更点だけ抽出して反映する”

3. 収束操作

* 比較が終わったら `:wqa`（両方保存して終了）など、終了動作を決めておくと事故が減ります。

---

## ７ Case 5：複数のファイルを同時に見る（split / vsplit）

![vi7.複数のファイルを同時に見る](/images/gamehub/vi7.複数のファイルを同時に見る.jpg)

### 図の要旨

`:sp`（上下分割）/ `:vsp`（左右分割）で、複数ファイルを見比べながら編集できる。

### 詳細解説

* 上下分割：

```vim
:sp filename
```

* 左右分割：

```vim
:vsp filename
```

* ウィンドウ間移動：

```text
Ctrl+w → 矢印（または h/j/k/l）
```

### Tips（開発者が即効で得する使い方）

1. 「定義（header/interface）」を見ながら「実装」を書く（図のままの用途）
2. 大きな設定ファイルの“関連箇所”を並べて編集する
3. 便利操作

* `Ctrl+w =`：分割サイズを均等化
* `:only`：今のウィンドウ以外を閉じる（収束に強い）

---

## ８ Case 6：条件に合う行を一括削除する（:g / :v）

![vi8.条件に合う行を一括削除する](/images/gamehub/vi8.条件に合う行を一括削除する.jpg)

### 図の要旨

`:g`（一致）/`:v`（不一致）で、ログ等から不要行を一括除去し、必要情報だけ残せる。

### 詳細解説

* コメント行を削除：

```vim
:g/^\s*#/d
```

* 空行を削除：

```vim
:g/^$/d
```

* ERRORを含まない行を削除（＝ERROR行だけ残す）：

```vim
:v/ERROR/d
```

### Tips（ログ調査の“残す発想”）

1. 「消す」より「残す」で事故が減る

* `:v/ERROR\|WARN/d` のように、“必要なもの以外を消す” 方向が強いです。

2. いきなり削除が怖い時は表示で確認

```vim
:g/ERROR/p
```

* 当たり方を見てから `d` に移る。

---

## ９ Case 7：コードを汚す「行末の空白」を一掃する

![vi9.コードを汚す「行末の空白」を一掃する](/images/gamehub/vi9.コードを汚す「行末の空白」を一掃する.jpg)

### 図の要旨

`:%s/\s\+$//` で、行末の不要な空白（スペース/タブ）をまとめて削除できる。

### 詳細解説

```vim
:%s/\s\+$//
```

* `\s`：空白文字
* `\+`：1回以上
* `$`：行末
* 置換後が空（`//`）なので削除になる

### Tips（レビュー差分を綺麗にする）

1. 置換で止めない（当たり無しでもエラー扱いにしない）

```vim
:%s/\s\+$//e
```

2. 不可視文字を見える化してから実行（安心）

```vim
:set list
```

（必要なら `:set nolist` で戻す）

---

## １０ Case 8：シェルの実行結果をエディタに貼る（:r !cmd）

![vi10.シェルの実行結果をエディタに貼る](/images/gamehub/vi10.シェルの実行結果をエディタに貼る.jpg)

### 図の要旨

`:r !date` や `:r !ls -l` で、コマンド出力をそのままバッファへ挿入できる。

### 詳細解説

* 日時を挿入：

```vim
:r !date
```

* ファイル一覧を挿入：

```vim
:r !ls -l
```

### Tips（運用・障害報告で刺さる）

1. 調査メモに“証跡”を貼れる

* 実行日時、対象ファイル一覧、環境情報（`uname -a` 等）を貼っておくと、後工程が速い。

2. 逆に「バッファ内容をコマンドへ流す」もできる（上級）

* `:%!jq .`（JSON整形）など、フィルタ整形が非常に強力（環境により）。

---

## １１ Case 9：複数のファイルを一気に書き換える（:argdo）

![vi11.複数のファイルを一気に書き換える](/images/gamehub/vi11.複数のファイルを一気に書き換える.jpg)

### 図の要旨

対象ファイル群に対して `:argdo` で同一置換を順次適用し、`update` で必要なものだけ保存する。

### 詳細解説

例（http → https を一括置換）：

```vim
:argdo %s#http://old-api#https://new-api#ge | update
```

* `argdo`：引数リスト（開いている複数ファイル）に対して順番に実行
* `g`：行内複数一致も対象
* `e`：一致なし等のエラーで停止しない
* `update`：変更があった場合のみ保存（無駄な更新を避ける）

### Tips（対象ファイルの作り方が肝）

1. 対象を “雑に全部” 開かず、まず狙う

* `vim *.conf` のようにグロブで対象を限定してから `argdo` すると安全。

2. 大規模リポジトリでは “quickfix + cfdo” が有利になる場合もある

* ただし、まずは本Caseの `argdo` を型として定着させるのが先決。

---

## １２ Case 10：目的の場所に一瞬で飛ぶ（G / gg / 123G / /検索）

![vi12.目的の場所に一瞬で飛ぶ](/images/gamehub/vi12.目的の場所に一瞬で飛ぶ.jpg)

### 図の要旨

巨大ファイル（ログ）での移動は“時間の本体”。ジャンプと検索で移動コストをゼロに寄せる。

### 詳細解説

* `G`：末尾へ
* `gg`：先頭へ
* `123G`：123行目へ
* `/ERROR`：下方向検索（`n` 次、`N` 前）

### Tips（トラブルシュート速度をさらに上げる）

1. ジャンプ履歴で戻る／進む

* `Ctrl+o`：戻る
* `Ctrl+i`：進む

2. 単語検索の高速化

* `*`：カーソル上の単語を次検索（ログのエラーコード追跡に強い）

3. 行番号が欲しい時

```vim
:set number
```

（調査中だけONにしても良い）

---

## １３ 【推奨設定】これだけは入れておきたい .vimrc

![vi13.（推奨設定）これだけはいれておきたい（.vinrc）](/images/gamehub/vi13.（推奨設定）これだけはいれておきたい（.vinrc）.jpg)

### 図の要旨

最小限の `.vimrc` で、検索性・視認性・インデント事故を改善する。

### 詳細解説

資料にある推奨例（最小セット）：

```vim
set number

set ignorecase
set smartcase

set hlsearch
set incsearch

set expandtab
set tabstop=4
set shiftwidth=4
```

### Tips（開発現場向けの追加候補：必要な場合だけ）

1. syntaxハイライト（可読性）

```vim
syntax on
```

2. “貼り付け崩れ”対策（端末環境による）

* pasteモード切替を用意する運用もあります（ただし環境差があるので、困ってから導入で十分）。

3. チーム規約がある場合

* `tabstop/shiftwidth` は**プロジェクト標準**に合わせないと、逆に差分汚染になります。

---

## １４ 開発者向け vi チートシート

![vi14.開発者向けviチートシート](/images/gamehub/vi14.開発者向けviチートシート.jpg)

### 図の要旨

10ケースの要点を「カテゴリ×コマンド」で即引きできる一覧。

### 詳細解説

* 置換：`:%s/A/B/gc`（確認付き）
* 編集：`Ctrl+v`（矩形＝列編集）
* 自動化：`qa ... q` / `@a`
* 差分：`vim -d A B`（差分表示）
* 分割：`:sp` / `:vsp`
* フィルタ：`:g/Pat/d`
* 外部：`:r !cmd`
* 整形：`:%s/\s\+$//`
* 複数：`:argdo ... | update`
* 移動：`G` / `/Pat`

### Tips（このチートシートの使い方）

* **事故防止が目的なら**：Case1（gc）とCase7（行末空白）を最優先
* **速度が目的なら**：Case10（ジャンプ）とCase6（フィルタ）
* **工数削減が目的なら**：Case3（マクロ）とCase9（argdo）

---

## １５ まとめ：ツールを使いこなしてこそ「プロ」

![vi15.まとめ：ツールをつかいこなしてこそ「プロ」](/images/gamehub/vi15.まとめ：ツールをつかいこなしてこそ「プロ」.jpg)

### 図の要旨

vi（Vim）は単なるエディタではなく、テキスト処理・ファイル操作・差分確認を統合した「開発者のためのプラットフォーム」である。

### 詳細解説

* 本資料の10機能は、明日からの実務に直結するものに絞っている。
* “作業の種類”で捉えると定着が早い：

  * **安全に変える**（置換/一括編集）
  * **速く探す**（検索/ジャンプ/フィルタ）
  * **速く揃える**（整形/一括適用）
  * **安全に比べる**（diff）

### Tips（次の一手：習慣化）

* まずは1つだけ選び、「同じ手作業を2回やらない」方向に倒してください。
  例：ログ調査なら Case10、設定修正なら Case2＋Case4、レビュー差分なら Case7。
