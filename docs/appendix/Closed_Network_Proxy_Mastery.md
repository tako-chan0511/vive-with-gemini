# プロキシの魔術師ハンドブック（閉域網 × プロキシ × AI開発）完全解説
## description: 閉域網（企業ネットワーク）で詰まりがちな「プロキシ・証明書・ツール設定・ガバナンス」を、全15ページを1ページずつ読み解いて実務に落とす


## 1. 表紙：プロキシの魔術師ハンドブック（企業ネットワーク攻略の書）

![Prx1.プロキシの魔術師ハンドブック](/images/network/Prx1.プロキシの魔術師ハンドブック.jpg)

### 図の要旨

* 閉域網（企業ネットワーク）の壁を越え、**公認のAI武器（tsuzumi / Azure OpenAI / GitHub Copilot）** を安全に使いこなすための“技術指南書”という位置づけです。
* 目的は「突破」ではなく、**ルールに従って最短で“開発が回る状態”を作る**ことです。

### 詳細解説（用語）

* **閉域網**：インターネットへ直接出ない（出られない）ネットワーク。外部アクセスは原則**プロキシ経由**。
* **公認ツール**：組織のセキュリティ・契約・監査に沿って利用が許可されたツール（＝シャドーITを避ける前提）。

### Tips（実務）

* この手の環境で最初にハマるのは実装力ではなく **「通し方（ネットワーク/証明書/ツール設定）」** です。以降は“通し方の地図”として読み進めるのが最短です。

---

## 2. 第1章：鉄壁の要塞「閉域網」を知る

![Prx2.第一章：鉄壁の要塞「閉域網」を知る](/images/network/Prx2.第一章：鉄壁の要塞「閉域網」を知る.jpg)

### 図の要旨

* 左（Wild Internet）と右（Closed Network）の間に **Proxy/Firewall** があり、`npm install` / `pip install` が**BLOCKED**になり得る、という現実を示しています。
* 解決策は「壁を越える唯一の手段＝プロキシ設定」。

### 詳細解説（用語）

* **Proxy / Firewall**：外部への出口を統制する装置。アクセス先制限、認証、監査、マルウェア検知などを担う。
* **閉域網の“現象”**：外部ダウンロード・APIコール・コンテナ取得などが不安定になりやすい（＝設定が揃っていないと即つまずく）。

### Tips（実務）

* 症状を見たら、まず3分類で切り分けると早いです

  1. **プロキシ未設定**（出口がない）
  2. **証明書問題**（SSLインスペクション）
  3. **ツール別設定不足**（OS設定だけでは足りない）

---

## 3. 第2章：門番「プロキシサーバー」との対話

![Prx3.第二章：門番「プロキシサーバー」との対話](/images/network/Prx3.第二章：門番「プロキシサーバー」との対話.jpg)

### 図の要旨

* 多くのツール（Python/Node/Docker）はデフォルトで「自由なインターネットにいる」と勘違いするため繋がらない、という説明です。
* “門番（Proxy Server）にIDを見せて通してもらう”ように、ツールへ教える＝環境変数設定が基本。

### 詳細解説（用語）

* **HTTP_PROXY**：HTTP通信のプロキシ。
* **HTTPS_PROXY**：HTTPS通信のプロキシ（実態はHTTP CONNECTでトンネルするケースが多い）。
* **認証付きプロキシ**：ID/パスワード、端末証明書、SSO連携などが必要なプロキシ。

### Tips（実務）

* まずは “curl が通るか” を最小検証にすると、原因の切り分けが速いです（ツールより前にネットワークを確認）。
* 次に “pip/npm/git/docker” の順で通し、どこで分岐するかを見ます（後述の「方言」）。

---

## 4. 奥義：門前の呪文「HTTP_PROXY」の解剖学

![Prx4.奥義の呪文「HTTP＿PROXY」の解剖学](/images/network/Prx4.奥義の呪文「HTTP＿PROXY」の解剖学.jpg)

### 図の要旨

* `export HTTP_PROXY="http://USER:PASS@proxy.example.co.jp:8080"` を分解し、どこが何か（プロトコル、認証、区切り、ホスト、ポート）を示しています。
* パスワードに `@` や `:` が含まれる場合は **URLエンコード**が必要、という警告が載っています。

### 詳細解説（用語）

* **URLエンコード**：特殊文字を `%xx` に変換し、URLとして壊れないようにする（例：`@`→`%40`）。
* **資格情報の直書き**：履歴・ログ・設定ファイルに残りやすいので運用上の注意点がある。

### Tips（実務）

* まずはこの最小セットを“ユーザー環境”に入れて疎通確認：

```bash
export HTTP_PROXY="http://USER:PASS@proxy.example.co.jp:8080"
export HTTPS_PROXY="http://USER:PASS@proxy.example.co.jp:8080"
```

* パスワードに `@` が入る例：`P@ss` → `P%40ss`
* 可能なら、資格情報をURLに埋めず「SSO/端末認証」側へ寄せる方が事故りにくいです（社内ルール優先）。

---

## 5. 防御呪文：迷走を防ぐ「NO_PROXY」

![Prx5.防御呪文：迷走を防ぐ「NO＿PROXY」](/images/network/Prx5.防御呪文：迷走を防ぐ「NO＿PROXY」.jpg)

### 図の要旨

* `NO_PROXY` を設定しないと、`localhost` や社内サーバへのアクセスまでプロキシに吸われ、**403**や遅延、社内Git不調が起きうる、という説明です。
* 必須例として `localhost / 127.0.0.1 / .nttdata.co.jp / 社内Gitや社内リポジトリのアドレス` が示されています。

### 詳細解説（用語）

* **NO_PROXY**：プロキシを経由しない宛先のリスト（カンマ区切りが一般的）。
* **“.ドメイン”指定**：`.example.co.jp` のようにサブドメイン全体を対象にする書き方。

### Tips（実務）

* まずは「守るべき最小」を入れる（環境に合わせて調整）：

```bash
export NO_PROXY="localhost,127.0.0.1,.nttdata.co.jp"
```

* “インターネットは見えるのに、社内Gitが遅い/繋がらない” は **NO_PROXYの疑いが濃厚**です。
* Docker/WSL/社内DNSが絡むと `NO_PROXY` に追加すべきホストが増えるため、チームで標準値を持つと再現性が上がります。

---

## 6. 第3章：信頼の証「SSL証明書」（MITMの正体）

![Prx6.第三章：信頼の証「SSL証明書」](/images/network/Prx6.第三章：信頼の証「SSL証明書」.jpg)

### 図の要旨

* 企業ネットワークではプロキシがTLS通信を一度復号して検査するため、ツール側がMITMと誤認し `SELF_SIGNED_CERT_IN_CHAIN` などのエラーを出す、という説明です。
* 対応は「会社のルート証明書（company.crt）をツールに信頼させる」。

### 詳細解説（用語）

* **SSLインスペクション**：DLP/マルウェア対策などのためにTLSを検査する運用。
* **社内ルートCA**：プロキシが再署名するための“社内の正規証明書”。端末/ツールがこれを信頼していないと失敗する。

### Tips（実務）

* このページにある登録例（そのまま実務で使う形）です。

```bash
# Python (pip)
pip config set global.cert /path/to/company.crt

# Node.js
export NODE_EXTRA_CA_CERTS="/path/to/company.crt"

# Git
git config --global http.sslCAInfo "/path/to/company.crt"
```

* まずインフラ/情シスへ確認すべき2点

  1. ルート証明書の配布手順（どのファイルが正か）
  2. 更新周期（いつ切り替わるか）
     ※ここが曖昧だと、ある日突然また壊れます。

---

## 7. 方言ガイド：ツールごとの設定法（git / docker / VSCode）

![Prx7.方言ガイド：ツールごとの設定方法](/images/network/Prx7.方言ガイド：ツールごとの設定方法.jpg)

### 図の要旨

* 環境変数だけでは不十分な場合があるため、ツール別に設定する（例：`git config --global http.proxy ...`）。
* Dockerは **Build時** と **Run時** で別（ビルド引数、実行時の `-e HTTP_PROXY`）。
* VSCodeは UI / `settings.json` で `http.proxy` を設定し、拡張機能インストールなどに必要。

### 詳細解説（用語）

* **Build時**：`docker build` でイメージを作る工程。ここで外部へ出るならプロキシが必要。
* **Run時**：`docker run` でコンテナを動かす工程。ホストの環境変数が自動継承されないことがある。
* **ツール内設定**：OS環境変数より優先される/されないなど、ツール固有の優先順位がある。

### Tips（実務）

* “まず通す順番”のおすすめ

  1. git（fetchが通るか）
  2. pip/npm（依存取得が通るか）
  3. docker build（ビルド時の外部取得が通るか）
  4. docker run（実行時の外部アクセスが通るか）
  5. VSCode（拡張機能/remote等が通るか）

---

## 8. 警告：野良ツールの罠と「王家の武器庫」

![Prx8.警告：野良ツールの罠と「王家の武器庫」](/images/network/Prx8.警告：野良ツールの罠と「王家の武器庫」.jpg)

### 図の要旨

* 個人の “Claude Code” や “ChatGPT（無料版）” を業務データで使うのは情報漏洩に繋がり得るため禁止、という強い警告です。
* 解決策として「安全が保証された公認環境（王家の武器庫）を使う」と示しています。

### 詳細解説（用語）

* **シャドーIT**：組織が許可していないIT利用。監査・事故対応ができず、最終的に全部止まる原因になりやすい。
* **データ漏洩**：入力（プロンプト）や添付、ログ貼り付けなど、意図せず外部送信されるリスク。

### Tips（実務）

* “禁止”の本質は「便利だからダメ」ではなく、**事故時に守れない**からです。
  公認環境に寄せるほど、スピードが落ちるどころか長期的に速くなります（止まらないため）。

---

## 9. 第4章：三種の神器（tsuzumi / Azure OpenAI / GitHub Copilot）

![Prx9.第四章：NTTデータ「三種の神器」](/images/network/Prx9.第四章：NTTデータ「三種の神器」.jpg)

### 図の要旨

* 公認の3ツールを「役割分担」して使えば、野良ツールに頼らず閉域でも強力に支援できる、という宣言です。

### 詳細解説（用語）

* **tsuzumi**：日本語・業務文書に強い“特化”寄り。
* **Azure OpenAI**：汎用・高性能・契約/閉域接続の枠で使う“汎用”寄り。
* **GitHub Copilot**：開発工程（実装/理解/レビュー）に効く“開発特化”寄り。

### Tips（実務）

* 使い分けの最短ルール（迷ったらこれ）

  * **文章の論点整理/日本語仕様** → tsuzumi
  * **幅広い壁打ち/整理/下書き** → Azure OpenAI
  * **コード理解/実装/テスト/レビュー** → Copilot

---

## 10. 神器1：tsuzumi（国産・軽量・日本語特化）

![Prx10.神器１：Tsuzumi（国産＆軽量＆日本語特化）](/images/network/Prx10.神器１：Tsuzumi（国産＆軽量＆日本語特化）.jpg)

### 図の要旨

* NTTが開発した純国産LLMで、日本語の機微や日本特有のビジネス文書（RFP/仕様書）理解が強い。
* 1GPUで動かせるほど軽量で、オンプレでも運用できる＝高秘匿データに向く。

### 詳細解説（用語）

* **RFP**：提案依頼書。論点が散らばりやすく、要点抽出が効く。
* **オンプレ**：社内環境で運用する形。規制・機密要件で必要になることがある。
* **軽量モデル**：必要十分な推論を少ない計算資源で実現する思想（コスト/運用性に効く）。

### Tips（実務）

* tsuzumiが刺さりやすい定番タスク

  * 仕様書から **決定事項/未決事項/要確認の前提** を抽出
  * 議事録から **ToDo/担当/期限** を構造化
  * 稟議や報告書の **要約＋指摘（矛盾/抜け）**
* プロンプト例（そのまま使える）

  * 「以下の文章を、(1)決定事項 (2)未決事項 (3)確認すべき前提 に分けて箇条書き。根拠の文も引用して。」

---

## 11. 神器2：Azure OpenAI（鉄壁の汎用知能）

![Prx11.神器２：AzureOpenAI（鉄壁の汎用知能）](/images/network/Prx11.神器２：AzureOpenAI（鉄壁の汎用知能）.jpg)

### 図の要旨

* 「入力データは学習に使われない（ゼロデータリテンション）」等の安心契約を前提に利用できる。
* ExpressRouteなどで閉域接続でき、インターネット非経由で漏洩リスクを最小化できる。

### 詳細解説（用語）

* **ゼロデータリテンション**：入力/出力の保持や学習利用を抑制する運用・契約の考え方（組織の契約条件に従う）。
* **ExpressRoute**：専用線/閉域接続の代表例。安定性と統制に効く。
* **汎用LLM**：広いタスクに対応する一方、使い方次第で誤り（ハルシネーション）も起きる。

### Tips（実務）

* Azure OpenAIが刺さりやすいタスク例

  * 設計の壁打ち（案を3つ出させ、比較表にする）
  * データの整理（要件→テーブル案→API案を段階生成）
  * コード生成の下書き（ただし最終責任は人間レビュー）
* 安全運用のコツ

  * 「根拠がないなら“不明”と言う」ルールをプロンプトに固定で入れる
  * 出力をそのまま採用せず、必ず一次情報（仕様/コード/規程）で確認する

---

## 12. 神器3：GitHub Copilot（全知のペアプログラマ）

![Prx12.神器３：GitHubCopilot（全治のペアプログラマ）](/images/network/Prx12.神器３：GitHubCopilot（全治のペアプログラマ）.jpg)

### 図の要旨

* Enterprise版は社内リポジトリやレガシーコード文脈を参照し、「この古いクラスは何をしている？」に答えられる。
* 導入効果（例）として、エンジニアの多くが時短を実感した旨が記載されています。
* 注意点：利用には**ライセンス割当/申請**が必要で、放置しても付かない場合がある。

### 詳細解説（用語）

* **レガシーコード**：仕様が暗黙で、変更が怖いコード。AIは“理解の初速”で効く。
* **ライセンス割当**：管理者がユーザーへ権限を付与して初めて利用可能になる方式。

### Tips（実務）

* Copilotで最初に整えると爆速になる“型”

  * コーディング規約（命名/例外/ログ/テスト方針）を先に貼る
  * 「最小変更」「既存機能を壊さない」「追加テストも提案」をセットで指示
* レガシー理解の質問テンプレ

  * 「このクラスの責務、入力/出力、依存、例外、変更時の影響範囲候補を列挙して」

---

## 13. 第5章：ギルドの掟（コミュニケーションと流儀）

![Prx13.第五章：ギルドの掟（コミュニケーションと流儀）](/images/network/Prx13.第五章：ギルドの掟（コミュニケーションと流儀）.jpg)

### 図の要旨

* Teams＝表玄関（公式会議/仕様/顧客連絡）、Slack＝作業場（エラー共有/雑談/技術相談）という使い分け。
* 鉄の掟：閉域のソースコードを許可なくインターネット側Slackへ貼り付け禁止。

### 詳細解説（用語）

* **表玄関（Formal）**：監査に残るべき合意・決裁・顧客向け説明。
* **作業場（Real-time）**：開発中のやり取り（ただし機密は出さない）。

### Tips（実務）

* 貼ってよい情報を“型”で固定すると事故が減ります

  * 例：エラー要約＋再現手順＋環境情報＋**マスク済み**ログ（鍵/URL/個人/社内名を削除）
* コード共有は「貼る」ではなく、社内GitのURLで（権限・監査が効く）。

---

## 14. 統治：AIガバナンスとリスク管理

![Prx14.統治：AIガバナンスとリスク管理](/images/network/Prx14.統治：AIガバナンスとリスク管理.jpg)

### 図の要旨

* AI利用はリスク評価（禁止/ハイリスク/限定リスク）に基づく“リスクベース・アプローチ”。
* ルールはガバナンス室/責任者が統制し、AI出力の最終判断は人間責任。「AIが言ったから」は通らない。

### 詳細解説（用語）

* **Prohibited / High Risk / Limited Risk**：使い方を段階分けし、審査・承認・運用の強度を変える枠組み。
* **ファクトチェック**：出力の真偽確認。AIは確率的生成なので、最終保証にはならない。

### Tips（実務）

* チームで最初に作ると強い“最低限のガバナンス三点セット”

  1. 入力禁止（個人情報・機密・鍵・顧客名など）
  2. 出力ルール（根拠提示、断定禁止、引用明記）
  3. 事故対応（誤出力/漏洩疑い時の連絡先と停止手順）
* “守り”はブレーキではなく、**安全にスピードを出すためのガードレール**です。

---

## 15. 最終章：グランドマスターへのチェックリスト

![Prx15.最終章：グランドマスターへのチェックリスト](/images/network/Prx15.最終章：グランドマスターへのチェックリスト.jpg)

### 図の要旨

* 最後に、現場が本当に詰まるポイントをチェックリスト化しています。

  * HTTP_PROXY / NO_PROXY は完璧か
  * 証明書を信頼させたか
  * 社内OID（ドメイン）等のアカウント確認
  * Copilot / tsuzumi の利用権限申請
  * Slackへのコード貼付禁止の理解

### 詳細解説（用語）

* **OID/SSO**：社内認証（サインイン）基盤。ここが無効だと、権限があっても使えない。
* **利用権限申請**：公認ツールでも「申請→割当」が必要な場合がある。

### Tips（実務）

* “初日に通す”ための最短チェック（手元の実行例）

```bash
# 1) プロキシの基本
echo "$HTTP_PROXY"
echo "$HTTPS_PROXY"
echo "$NO_PROXY"

# 2) Gitの確認（プロキシ/証明書）
git config --global --get http.proxy
git config --global --get https.proxy
git config --global --get http.sslCAInfo

# 3) pipの確認（証明書）
pip config list | grep -i cert || true
```

* 最後の一言（このページの結論）：準備が整うと、閉域網でも“最強の開発速度”が出せます。

---

# 付録（詳細説明）
## 閉域網における開発環境構築と生成AI活用ガイド：プロキシ・SSL証明書・ツール設定の詳説

本文書は、NTTデータ等の高度なセキュリティが要求される企業の閉域網（イントラネット）において、開発ツールおよび生成AIを安全かつ効率的に利用するための設定方法と、社内AIエコシステムの活用戦略をまとめたものである。


![Prx16.閉域網（クローズドネットワーク）開発サバイバルガイド：プロキシ＆証明書＆ツール設定まとめ](/images/network/Prx16.閉域網（クローズドネットワーク）開発サバイバルガイド：プロキシ＆証明書＆ツール設定まとめ.jpg)


## 1. 門番としての「プロキシサーバー」：通信制御のメカニズム

閉域網からインターネットへ接続する際、すべての通信は厳重なプロキシサーバーを経由する必要がある。この「門番」を正しく通過するための設定が、開発環境構築の第一歩となる。

### 1.1 聖なる3つの環境変数

すべての開発ツール（Git、Docker、Python、npm等）が参照する基本設定である。

| 環境変数 | 役割 | 設定のポイント |
|---|---|---|
| `HTTP_PROXY` | 暗号化されていない通信（http）用 | `http://user:pass@proxy.example.co.jp:8080` の形式で指定 |
| `HTTPS_PROXY` | 暗号化された通信（https）用 | 現在のWeb通信の主流。必ず設定が必要 |
| `NO_PROXY` | プロキシを除外する宛先 | `localhost` や社内ドメインを指定。設定ミスは社内サーバーへの接続失敗を招く |
* HTTP(S)_PROXYは閉域網ではインターネットに出る唯一の出口を設定するために必須です。これがないと迷子（すべての外部通信がタイムアウトで失敗）になります。
* HTTP関連の設定後はNO_PROXYも必須です。これがないと折角プロキシを通れるようになっても、今度は社内サーバや自分自身（localhost）へのアクセスもプロキシに向かって接続できなくなります。
```
1. コマンドの解読１（HTTP_PROXY）
export HTTP_PROXY="http://USER:PASS@proxy.example.co.jp:8080"
この文字列は、以下の5つの要素で構成されています。
1. http:// (先頭): プロキシサーバーとの通信プロトコルです。HTTPS_PROXY の設定であっても、プロキシ自体への接続は http:// と書くのが一般的です。
2. USER: あなたの社内ネットワークID（社員番号やメールアドレスのアカウント名など）が入ります。
3. : (コロン): IDとパスワードの区切り文字です。
4. PASS: あなたの社内ネットワークログインパスワードが入ります。（※ここに最大の罠があります。後述）
5. @ (アットマーク): 「認証情報（左側）」と「サーバー情報（右側）」の区切り文字です。
6. proxy.example.co.jp: 会社のプロキシサーバーのアドレス（FQDNまたはIPアドレス）です。インフラ担当者から指定されたものを使います。
7. :8080: ポート番号です。会社によって 80 や 8080、10080 など異なります。
2. 【最重要】パスワードに記号が入っている場合の「罠」
もし、あなたのパスワードに @ や : 、! などの記号が含まれている場合、そのまま書くと設定は失敗します。
• 失敗例: パスワードが P@ssword の場合 http://user:P@ssword@proxy... → システムは、最初の @ を「認証情報の終わり」と勘違いしてしまい、「user:P」というID/PASSで「ssword@proxy...」というサーバーに繋ごうとしてエラーになります。
• 成功例（URLエンコード）: 記号を「URLエンコード（%表記）」に変換して記述する必要があります。
    ◦ @ → %40
    ◦ : → %3A
    ◦ ! → %21
    ◦ # → %23
• 書き換え例: http://user:P%40ssword@proxy..

２．コマンド解読２（NO_PROXY）
必ず NO_PROXY もセットで設定してください。
export NO_PROXY="localhost,127.0.0.1,.nttdata.co.jp,10.0.0.0/8"
これがないと、せっかくプロキシを通れるようになっても、今度は「社内サーバーや自分自身（localhost）」へのアクセスまでプロキシに向かってしまい、接続できなくなります
```

---

## 2. 信頼の証「SSL証明書」：SSLインスペクションへの対処

企業の閉域網では、情報漏洩対策（DLP）やマルウェア対策として、通信を一度復号して検査する「SSLインスペクション（MITM：中間者攻撃と同様の手法）」が行われている。

### 2.1 SSLエラーの正体

ツール側がプロキシの再暗号化に使われる「社内ルート証明書」を認識していない場合、`SELF_SIGNED_CERT_IN_CHAIN`（自己署名証明書エラー）が発生し、通信が遮断される。

### 2.2 社内ルート証明書の適用手順

1. **入手**：インフラ担当者よりBase64形式の証明書（`.crt` または `.pem`）を入手する。  
2. **信頼させる**：各ツールに対して「この証明書は正規のものである」と教え込む設定を行う。
```
NTTデータのようなエンタープライズ環境（閉域網）において、SSL証明書（.crt や .pem）は、**「Windows（OS）には自動配布されるが、開発ツール（Python/Docker等）には手動で認識させる必要がある」**という点が最大の落とし穴です。
社内のセキュリティ製品（Zscalerやi-FILTERなど）が通信を検査（SSL復号化）しているため、開発ツールに「会社のルート証明書」を信頼させないと SELF_SIGNED_CERT_IN_CHAIN などのエラーで動きません,。
以下に、現場でエンジニアが行うべき**「開発ツールへの証明書配布（適用）手順」**をまとめました。
1. 証明書ファイルの入手（準備）
まず、手元に「会社のルート証明書ファイル」を用意する必要があります。
• 入手方法A（推奨）: インフラ担当または現場リーダーに「プロキシのルート証明書（Base64形式の .crt または .pem）をください」と依頼する。
• 入手方法B（自力）:
    1. 社給PCのブラウザ（Edge/Chrome）で社内イントラネット等のHTTPSサイトを開く。
    2. URLバーの「鍵マーク」をクリック →「この接続は安全です」→「証明書」を開く。
    3. 「証明のパス」タブで一番上の「Root CA」を選択し、「証明書の表示」。
    4. 「詳細」タブ →「ファイルにコピー」→「Base64 encoded X.509 (.CER)」を選択して保存。
    5. 保存したファイルの拡張子を .crt または .pem に変更する。
2. 各開発ツールへの適用手順
入手した証明書ファイル（例: CompanyRootCA.crt）を、各ツールに設定します。
① Python (pip)
PythonはOSの証明書ストアを見に行かないため、個別に設定が必須です。
• コマンド:
• ※これで pip install が通るようになります。
② Node.js (npm / Difyなど)
Node.jsも独自に証明書を管理しています。環境変数で指定するのが一般的です。
• 環境変数設定（Windows/PowerShell）:
• 恒久対応: ユーザー環境変数に NODE_EXTRA_CA_CERTS を追加してください。
③ Git (GitHub Copilot利用に必須)
GitもSSLエラーが出やすいツールです。
• コマンド:
• ※これを設定しないと、GitHubからのCloneやPushが失敗します。
④ Docker (最難関)
Dockerは、コンテナを作成するたびに証明書が必要です。
• ビルド時（Dockerfile）: COPY コマンドで証明書をコンテナ内の /usr/local/share/ca-certificates/ に配置し、update-ca-certificates を実行する処理を書く必要があります。
• 実行時（docker run）: ボリュームマウントで証明書を渡すか、環境変数 REQUESTS_CA_BUNDLE 等を利用するケースがあります,。
⑤ VS Code
VS Code自体の通信（拡張機能のインストールなど）用です。
• 設定: Ctrl + , で設定を開き、http.systemCertificates が有効（チェックが入っている）か確認してください。通常はこれでOSの証明書を利用しますが、ダメな場合は http.proxyStrictSSL を false にする（セキュリティリスクあり）か、win-ca 拡張機能を導入します。
3. 動作確認
設定後、以下のコマンドでエラーが出ないか確認してください。
# curlでの確認（プロキシ経由）
curl -v --cacert C:\Path\To\CompanyRootCA.crt https://www.google.com
Connected to proxy と表示され、HTMLが返ってくれば成功です。
アドバイス: この証明書ファイルは**「開発の命綱」**です。C:\Cert\ などのわかりやすいフォルダに置き、パスを通しておくと便利です。
```
---

## 3. ツール別詳細設定ガイド

各ツールには固有の設定（方言）が存在する。OSの環境変数設定だけでは不十分なケースが多い。

### 3.1 Gitの設定

リポジトリのクローンやプッシュに必須の設定である。

- **プロキシ設定**
- **SSL証明書指定**

### 3.2 Dockerの設定

Dockerは「イメージ取得時（Daemon）」と「コンテナ実行時（Container）」の2箇所で設定が必要な、最難関の関門である。

| フェーズ | 設定箇所 | 備考 |
|---|---|---|
| イメージ取得（pull） | `/etc/systemd/system/docker.service.d/http-proxy.conf` | `docker pull` 実行時にプロキシを通すための設定 |
| ビルド（build） | `docker build --build-arg HTTP_PROXY=$HTTP_PROXY .` | ビルド引数として環境変数を渡す |
| コンテナ内（run） | `~/.docker/config.json` または環境変数 | コンテナ内で動作するアプリ（pip等）が外に出るための設定 |

### 3.3 Node.js（npm / Dify等）の設定

Node.jsは独自の証明書管理を行っているため、環境変数の追加が効果的である。

- **プロキシ設定**：`npm config set proxy http://...`
- **証明書設定**：環境変数 `NODE_EXTRA_CA_CERTS` に証明書のパスを指定する。

### 3.4 VSCodeの設定

拡張機能のインストール等にプロキシ設定が必要。

- **Settings（Ctrl+,）**：`proxy` と検索し、Proxy URLを入力。
- **SSL設定**
  - `http.systemCertificates` を有効にする  
  - 証明書エラーが出る場合は一時的に `http.proxyStrictSSL` を `false` にする  
    - ※ただしセキュリティリスクを伴う

---

## 4. 社内生成AIエコシステムの活用戦略

閉域網内では、外部の「野良ツール（Claude Code等）」を個人で導入することは、技術的に不可能であるだけでなく、重大な情報漏洩リスク（懲戒リスク）となる。社内で認可された以下の3つのエコシステムを使い分けることが正解である。

### 4.1 tsuzumi（NTT版LLM）

NTTがフルスクラッチで開発した軽量・高性能な純国産LLM。

- **特徴**：日本語の機微、日本企業特有のドキュメント構造に強い。1GPUで動作可能。
- **用途**：日本語の仕様書・マニュアルの要約、専門用語の処理。秘匿性の高いデータのオンプレミス運用。

### 4.2 Azure OpenAI Service

Microsoft Azure上で提供される、エンタープライズグレードのセキュアなGPTモデル。

- **特徴**：入力データがモデルの学習に利用されないことが保証されている。閉域接続（ExpressRoute）が可能。
- **用途**：高度な論理推論、データ整形、設計書の壁打ち、英語技術ドキュメントの翻訳。

### 4.3 GitHub Copilot Enterprise

社内の全GitHubリポジトリを学習・検索可能なペアプログラマ。

- **特徴**：統一されたセキュリティポリシー下で提供される。レガシーコードの解説、社内標準規約に沿ったコード生成が可能。
- **用途**：既存コードの解読、プルリクエストの自動要約、開発生産性の向上。

---

## 5. 現場でのデバッグと実務上の鉄則

環境構築でトラブルが発生した際の迅速な対処法を以下に示す。

### 5.1 接続確認の「魔法のコマンド」

- `curl -v https://google.com`
  - `Connected to proxy` と出ればプロキシ設定は成功。
  - SSLエラーが出れば証明書設定の問題。
  - `Could not resolve host` と出ればDNSまたはプロキシ設定自体のミス。

### 5.2 セキュリティ・コンプライアンス

- 外部AIサーバーにソースコードを送信する行為は、顧客との契約違反（情報漏洩）に直結する。
- 許可されていないツールの利用（Shadow IT）は厳禁。社内アカウント（通行手形）に基づく認可環境のみを利用すること。

### 5.3 権限の申請

- アカウントが発行されていても、GitHub Copilot等の利用には別途「ライセンス割り当て」の申請が必要な場合が多い。着任時にPMへ確認することが推奨される。
```
