# API設計のイロハ

Web API を設計・実装する際に押さえておきたい基本原則と実践的なポイントを解説します。

---

## 1. URI設計の基本

- **リソースベース設計（名詞で）**
  - ✅ `/users/123`：OK
  - ❌ `/getUser?id=123`：NG
- **階層構造の活用**：
  - `/users/123/posts`：指定ユーザの投稿一覧

---

## 2. HTTPメソッドの使い分け

| メソッド | 概要         | 使用例           |
|----------|--------------|------------------|
| GET      | データ取得   | `/articles`      |
| POST     | 新規作成     | `/articles`      |
| PUT      | 全体更新     | `/articles/1`    |
| PATCH    | 部分更新     | `/articles/1`    |
| DELETE   | 削除         | `/articles/1`    |

---

## 3. ステータスコード

| コード | 意味                       |
|-------|----------------------------|
| 200   | OK（成功）                 |
| 201   | Created（作成成功）       |
| 204   | No Content（削除など）    |
| 400   | Bad Request（不正リクエスト） |
| 401   | Unauthorized（認証失敗）  |
| 403   | Forbidden（権限なし）     |
| 404   | Not Found（存在しない）   |
| 500   | Internal Server Error      |

---

## 4. JSONレスポンス設計例

```json
{
  "status": "success",
  "data": {
    "id": 123,
    "name": "Taro"
  },
  "message": "ユーザーを取得しました"
}
````

---

## 5. エラーハンドリング

```json
{
  "status": "error",
  "code": "USER_NOT_FOUND",
  "message": "指定されたユーザーが存在しません"
}
```

---

## 6. バージョン管理

* URIにバージョンを含める：

  * `/api/v1/users`
* 将来的な変更に備えた設計

---

## 7. 認証・認可

* HTTPS必須
* JWT または OAuth2 の採用
* APIキー/IP制限/WAFによるセキュリティ強化

---

## 8. ドキュメント管理

* OpenAPI(Swagger) でドキュメント化
* Postman Collection や モックサーバ活用

---

## 9. 非機能対策

* レートリミット（DoS対策）
* ログ（CloudWatch, ELK）
* ヘルスチェック（/health）
* フォールバック処理
* 再試行（リトライ）

---

## 10. 開発・運用体制

* CI/CD（GitHub Actions など）
* バージョン管理・ステージング環境
* IaC（Terraform, CloudFormation）

ーーーー

# API設計 チェックリスト ✅

| チェック項目 | 確認済 | メモ |
|--------------|--------|------|
| URI設計が REST に準拠しているか？ |  | リソースは名詞／階層構造 |
| HTTPメソッドが適切に使われているか？ |  | POST/GET/PATCH など |
| レスポンス形式が統一されているか？ |  | success/error形式 |
| エラーハンドリングが一貫しているか？ |  | エラーコード、詳細 |
| ステータスコードが適切に返されているか？ |  | 201, 400, 500など |
| バージョン管理されているか？ |  | `/api/v1/...` |
| 認証／認可が導入されているか？ |  | JWT、OAuth2 |
| HTTPS強制がされているか？ |  | - |
| ドキュメントが存在しているか？ |  | Swagger / Postman |
| モック環境が準備されているか？ |  | テスト用サーバ |
| ログ出力は適切か？ |  | CloudWatch/ELK連携 |
| APIキーや環境変数は安全に管理されているか？ |  | `.env`/Secrets管理 |
| レートリミットやキャッシュ戦略があるか？ |  | Redis/ETag |
| 冗長化やリトライ・フォールバック戦略あり？ |  | タイムアウト対応など |
| CI/CD環境でテスト・デプロイできるか？ |  | GitHub Actions 等 |
