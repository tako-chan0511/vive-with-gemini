# デモシナリオ

## 仕様変更に追随する「進化するテスト」の実演

このシナリオでは、AIとのバイブコーディングが、単なる初期開発だけでなく、**継続的な保守・運用における仕様変更**にいかに強く、ROI向上に貢献するかを実演します。

---

### ステップ1：テストが存在しない状態

**[アクション]**
1.  `companyAnalysis.ts` ファイルを開き、`getCompanyAttentionLevel` 関数を見せる。
2.  対応するテストファイルが空であることを見せる。

**[トーク内容]**
「こちらに、ニュース件数に応じて企業の注目度を判定する簡単な関数があります。ご覧の通り、まだテストコードが一切書かれていない状態です。ここから、Geminiと一緒にテストを書いていきます。」

**`companyAnalysis.ts`**
```typescript
export function getCompanyAttentionLevel(newsCount: number): '高' | '中' | '低' {
  if (newsCount >= 20) {
    return '高';
  } else if (newsCount >= 5) {
    return '中';
  } else {
    return '低';
  }
}
```

---

### ステップ2：AIによるテストの初回作成

**[アクション]**
1. Geminiのチャット画面を開く。
2. `getCompanyAttentionLevel` 関数のコードを貼り付け、以下のプロンプトを入力する。

**[トーク内容]**
「では、この関数のテストをGeminiに作ってもらいます。C1網羅率、つまり全てのコードが一度は実行されるテストを100%満たすようにお願いしてみましょう。」

**[プロンプト]**
> この`getCompanyAttentionLevel`関数の単体テストを、C1網羅率100%になるようにVitestで作成してください。

**[アクション]**
1. Geminiが生成したテストコードをコピーする。
2. テストファイルに貼り付け、保存する。
3. ターミナルで `npm run docs:dev -- --coverage` を実行し、カバレッジレポートで網羅率が100%になっていることを見せる。

**[トーク内容]**
「はい、コードが生成されました。これを貼り付けてテストを実行します...。ご覧ください、全ての分岐を網羅したテストが自動で作成され、カバレッジも100%になりました。テスト作成のコストが大幅に削減できます。」

---

### ステップ3：仕様変更とテストの自動追随

**[アクション]**
1. `companyAnalysis.ts` ファイルのロジックを直接編集する。

**[トーク内容]**
「ここで、ビジネスサイドから緊急の仕様変更依頼が来たと仮定します。『注目度: 高の基準を20件から30件に引き上げ、新たに"超高"ランクを追加する』という内容です。まず、関数のロジックを直接修正します。」

**`companyAnalysis.ts` (変更後)**
```typescript
export function getCompanyAttentionLevel(newsCount: number): '超高' | '高' | '中' | '低' {
  if (newsCount >= 50) { // "超高"ランクを追加
    return '超高';
  } else if (newsCount >= 30) { // 基準を20から30に変更
    return '高';
  } else if (newsCount >= 5) {
    return '中';
  } else {
    return '低';
  }
}
```

**[アクション]**
1. **古いテストコードのまま** `npm run docs:dev` を実行し、テストが**失敗**することを見せる。

**[トーク内容]**
「ロジックだけを修正したので、当然ですが既存のテストは失敗します。これが、テストが仕様変更の"検知器"として正しく機能している証拠です。ここからが本番です。この失敗したテストを、再度Geminiに修正してもらいます。」

**[アクション]**
1. Geminiのチャット画面に、**変更後の関数コード**と**古いテストコード**を両方貼り付け、以下のプロンプトを入力する。

**[プロンプト]**
> この関数の仕様が変更されました。新しい仕様に合わせて、このテストコードを修正・更新してください。C1網羅率100%は維持してください。

**[アクション]**
1. Geminiが生成した**更新版のテストコード**をテストファイルに貼り付け、上書き保存する。
2. 再度テストを実行し、全てのテストが通り、カバレッジも100%に復帰することを見せる。

**[トーク内容]**
「更新されたテストコードを貼り付けます...。はい、ご覧ください。新しい仕様に合わせたテストに修正され、再びオールグリーンになりました。このように、仕様変更に伴うテストコードの修正という、非常に手間のかかる作業もAIが肩代わりしてくれます。これが、保守・運用フェーズにおけるアジリティとROIを劇的に向上させる『バイブコーディング』の一例です。」